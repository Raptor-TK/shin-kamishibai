<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta
			content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
			name="viewport"
		/>
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<title>Kamishibai</title>
		<style>
			button {
				font-size: 2em;
				/* margin-right: 0.5em; */
			}
			.row {
				margin-bottom: 0.5em;
			}
			.a-link {
				padding: 0.7em;
				margin: 0.3em;
				background: greenyellow;
				display: inline-block;
			}
			.div-img {
				margin-bottom: 0.5em;
			}
			.img-manga {
				min-width: 300px;
				min-height: 400px;
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
		<div class="row">
			<div><button onclick="goBrowse();">Browse</button></div>
			<div>Path: <span id="span-folder-name">&nbsp;</span></div>
			<div>File: <span id="span-file-name">&nbsp;</span></div>
			<div>Page: <span id="span-page">&nbsp;</span> / <span id="span-page-total">&nbsp;</span></div>
		</div>
		<div class="row">
			<div>
				<button onclick="prevPage();">-5</button>
				<button onclick="nextPage();">+5</button>
				<button onclick="prevPage();">Prev</button>
				<button onclick="nextPage();">Next</button>
			</div>
			<div id="div-links-top">
				<a href="/?page=1" class="a-link">1</a>
			</div>
		</div>
		<div class="row">
			<div class="div-img" id="div-img-1"><img src="/img/1.jpg" class="img-manga" id="img-1" /></div>
			<div class="div-img" id="div-img-2"><img src="/img/2.jpg" class="img-manga" id="img-2" /></div>
			<div class="div-img" id="div-img-3"><img src="/img/3.jpg" class="img-manga" id="img-3" /></div>
			<div class="div-img" id="div-img-4"><img src="/img/4.jpg" class="img-manga" id="img-4" /></div>
			<div class="div-img" id="div-img-5"><img src="/img/5.jpg" class="img-manga" id="img-5" /></div>
			<div class="div-img" id="div-img-6"><img src="/img/6.jpg" class="img-manga" id="img-6" /></div>
			<div class="div-img" id="div-img-7"><img src="/img/7.jpg" class="img-manga" id="img-7" /></div>
			<div class="div-img" id="div-img-8"><img src="/img/8.jpg" class="img-manga" id="img-8" /></div>
			<div class="div-img" id="div-img-9"><img src="/img/9.jpg" class="img-manga" id="img-9" /></div>
			<div class="div-img" id="div-img-10"><img src="/img/10.jpg" class="img-manga" id="img-10" /></div>
			<div class="div-img" id="div-img-11"><img src="/img/11.jpg" class="img-manga" id="img-11" /></div>
			<div class="div-img" id="div-img-12"><img src="/img/12.jpg" class="img-manga" id="img-12" /></div>
			<div class="div-img" id="div-img-13"><img src="/img/13.jpg" class="img-manga" id="img-13" /></div>
			<div class="div-img" id="div-img-14"><img src="/img/14.jpg" class="img-manga" id="img-14" /></div>
			<div class="div-img" id="div-img-15"><img src="/img/15.jpg" class="img-manga" id="img-15" /></div>
		</div>
		<div class="row">
			<div>Page: <span id="span-bottom-page">&nbsp;</span> / <span id="span-bottom-page-total">&nbsp;</span></div>
		</div>
		<div class="row">
			<div><button onclick="prevPage();">Prev</button> <button onclick="nextPage();">Next</button></div>
			<div id="div-links-bottom"></div>
		</div>
		<script>
			window.onload = ready;

			// these needs to be ajax
			page = 1;
			imageTotal = 213;
			pageTotal = Math.ceil(imageTotal / 15);

			function ready() {
				updatePage(page);
				updateLinks(imageTotal);
				console.log("page ", page, "is ready");
			}

			function prevPage() {
				if (page <= 1) return;
				page = page - 1;
				console.log(page);
				updatePage(page, true);
			}

			function nextPage() {
				if (page >= pageTotal) return;
				page = page + 1;
				console.log(page);
				updatePage(page);
			}

			function updateLinks(ttlPages) {
				var pg = Number(ttlPages);
				if (isNaN(pg)) return;

				// clear child elements
				var nodeTop = document.getElementById("div-links-top");
				while (nodeTop.firstChild) {
					nodeTop.removeChild(nodeTop.firstChild);
				}
				var nodeBottom = document.getElementById("div-links-bottom");
				while (nodeBottom.firstChild) {
					nodeBottom.removeChild(nodeBottom.firstChild);
				}

				// recreate links
				for (var i = 1; i < pageTotal; i++) {
					var a = document.createElement("a");
					a.href = "/?page=" + String(i);
					a.className = "a-link";
					a.innerText = String(i);

					var a2 = document.createElement("a");
					a2.href = "/?page=" + String(i);
					a2.className = "a-link";
					a2.innerText = String(i);

					nodeTop.appendChild(a);
					nodeBottom.appendChild(a2);
				}

				console.log(elLinkTop.outerHTML);
			}

			function updatePage(p, isReverse) {
				var pg = Number(p);
				if (isNaN(pg)) return;
				if (pg < 1) return;

				// update page info
				document.getElementById("span-page").textContent = pg;
				document.getElementById("span-page-total").textContent = pageTotal;
				// update page info
				document.getElementById("span-bottom-page").textContent = pg;
				document.getElementById("span-bottom-page-total").textContent = pageTotal;

				// update image srcs
				pg = pg - 1;
				for (var i = 1; i < 16; i++) {
					var el = document.getElementById("img-" + String(i));

					var img_pg = 15 * pg + i;

					if (img_pg <= imageTotal) {
						el.setAttribute("src", "/img/" + img_pg + ".jpg");
					} else {
						el.removeAttribute("src");
					}
				}

				if (isReverse) {
					// scroll to bottom of page
					window.scrollTo(0, document.body.scrollHeight);
				} else {
					// scroll to top of page
					document.body.scrollTop = 0; // For Safari
					document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
				}
			}

			function goBrowse() {
				console.log("hoooome");
			}
		</script>
	</body>
</html>
